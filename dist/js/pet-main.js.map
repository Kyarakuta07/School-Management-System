{"version":3,"file":"pet-main.js","sources":["../../moe/user/js/pet/config.js","../../moe/user/js/pet/state.js","../../moe/user/js/pet/ui.js","../../moe/user/js/pet/pets.js","../../moe/user/js/pet/collection.js","../../moe/user/js/pet/inventory.js","../../moe/user/js/pet/gacha.js","../../moe/user/js/pet/shop.js","../../moe/user/js/pet/arena.js","../../moe/user/js/pet/main.js"],"sourcesContent":["/**\r\n * Configuration & Constants\r\n * @module pet/config\r\n * @description Central configuration file for the pet system\r\n * \r\n * @author MOE Development Team\r\n * @version 2.0.0\r\n */\r\n\r\n/**\r\n * Base URL for API requests\r\n * @constant {string}\r\n */\r\nexport const API_BASE = 'api/router.php';\r\n\r\n/**\r\n * Base path for pet asset images\r\n * @constant {string}\r\n */\r\nexport const ASSETS_BASE = '../assets/pets/';\r\n\r\n/**\r\n * Default setting for compact gold display mode\r\n * @constant {boolean}\r\n */\r\nexport const GOLD_COMPACT_MODE = true;\r\n\r\n/**\r\n * Maximum number of pets a user can own\r\n * @constant {number}\r\n */\r\nexport const MAX_PETS = 25;\r\n\r\n/**\r\n * Gacha costs in gold\r\n * @constant {Object}\r\n * @property {number} standard - Cost for standard gacha\r\n * @property {number} premium - Cost for premium gacha (uses ticket instead)\r\n */\r\nexport const GACHA_COSTS = {\r\n    standard: 50,\r\n    premium: 0\r\n};\r\n\r\n/**\r\n * Stat decay rates per hour\r\n * @constant {Object}\r\n * @property {number} hunger - Hunger decay per hour\r\n * @property {number} mood - Mood decay per hour\r\n * @property {number} health - Health decay per hour (when hunger = 0)\r\n */\r\nexport const DECAY_RATES = {\r\n    hunger: 5,\r\n    mood: 3,\r\n    health: 8\r\n};\r\n","/**\r\n * Application State Management\r\n * @module pet/state\r\n * @description Centralized state management for the pet system\r\n * \r\n * @author MOE Development Team\r\n * @version 2.0.0\r\n */\r\n\r\n/**\r\n * Global application state object\r\n * @type {Object}\r\n * @property {string} currentTab - Currently active tab ID\r\n * @property {Array<Object>} userPets - Array of user's pets\r\n * @property {Object|null} activePet - Currently active pet object\r\n * @property {Array<Object>} shopItems - Available shop items\r\n * @property {Array<Object>} userInventory - User's inventory items\r\n * @property {string|null} selectedItemType - Selected item type for filtering\r\n * @property {Object|null} currentBulkItem - Item being used in bulk modal\r\n * @property {Object|null} currentReviveItem - Item being used for revival\r\n * @property {Object|null} currentShopItem - Item being purchased\r\n * @property {Object|null} dailyRewardData - Daily login reward data\r\n * @property {boolean} isGoldCompact - Whether gold display is in compact format\r\n */\r\nexport const state = {\r\n    currentTab: 'my-pet',\r\n    userPets: [],\r\n    activePet: null,\r\n    shopItems: [],\r\n    userInventory: [],\r\n    selectedItemType: null,\r\n    currentBulkItem: null,\r\n    currentReviveItem: null,\r\n    currentShopItem: null,\r\n    dailyRewardData: null,\r\n    isGoldCompact: true\r\n};\r\n\r\n// Expose to window for compatibility with pixi_pet.js and HTML onclick handlers\r\nif (typeof window !== 'undefined') {\r\n    /**\r\n     * Create reactive proxies that synchronize state with window globals\r\n     * This ensures backward compatibility with legacy code\r\n     */\r\n    Object.defineProperty(window, 'userPets', {\r\n        get: () => state.userPets,\r\n        set: (value) => { state.userPets = value; }\r\n    });\r\n\r\n    Object.defineProperty(window, 'activePet', {\r\n        get: () => state.activePet,\r\n        set: (value) => { state.activePet = value; }\r\n    });\r\n}\r\n","/**\r\n * UI Utilities Module\r\n * @module pet/ui\r\n * @description Handles UI interactions, toasts, modals, tabs, gold display, and daily rewards\r\n * \r\n * @author MOE Development Team\r\n * @version 2.0.0\r\n */\r\n\r\nimport { API_BASE } from './config.js';\r\nimport { state } from './state.js';\r\n\r\n// ================================================\r\n// TOAST NOTIFICATIONS\r\n// ================================================\r\n\r\n/**\r\n * Display a toast notification message\r\n * @param {string} message - The message to display\r\n * @param {'success'|'error'|'warning'|'info'} [type='success'] - Toast type/style\r\n * @returns {void}\r\n * @example\r\n * showToast('Pet fed successfully!', 'success');\r\n * showToast('Not enough gold', 'error');\r\n */\r\nexport function showToast(message, type = 'success') {\r\n    let toast = document.getElementById('toast');\r\n\r\n    if (!toast) {\r\n        toast = document.createElement('div');\r\n        toast.id = 'toast';\r\n        toast.className = 'toast';\r\n        toast.innerHTML = '<i class=\"toast-icon fas\"></i><span class=\"toast-message\"></span>';\r\n        document.body.appendChild(toast);\r\n    }\r\n\r\n    const icon = toast.querySelector('.toast-icon');\r\n    const msg = toast.querySelector('.toast-message');\r\n\r\n    const icons = {\r\n        success: 'fa-check-circle',\r\n        error: 'fa-times-circle',\r\n        warning: 'fa-exclamation-circle',\r\n        info: 'fa-info-circle'\r\n    };\r\n\r\n    if (icon) icon.className = `toast-icon fas ${icons[type] || icons.success}`;\r\n    if (msg) msg.textContent = message;\r\n\r\n    toast.className = `toast ${type}`;\r\n    toast.classList.add('show');\r\n\r\n    setTimeout(() => {\r\n        toast.classList.remove('show');\r\n    }, 3000);\r\n}\r\n\r\n// ================================================\r\n// TAB NAVIGATION\r\n// ================================================\r\n\r\n/**\r\n * Initialize tab navigation click handlers\r\n * @returns {void}\r\n */\r\nexport function initTabs() {\r\n    const tabBtns = document.querySelectorAll('.tab-btn');\r\n    tabBtns.forEach(btn => {\r\n        btn.addEventListener('click', () => {\r\n            const tab = btn.dataset.tab;\r\n            switchTab(tab);\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Switch to a specific tab and update UI\r\n * @param {string} tab - The tab ID to switch to (e.g., 'my-pet', 'collection', 'gacha')\r\n * @fires tabChanged - Custom event dispatched when tab changes\r\n * @returns {void}\r\n */\r\nexport function switchTab(tab) {\r\n    // Update buttons\r\n    document.querySelectorAll('.tab-btn').forEach(btn => {\r\n        btn.classList.toggle('active', btn.dataset.tab === tab);\r\n    });\r\n\r\n    // Update content\r\n    document.querySelectorAll('.tab-content, .tab-panel').forEach(content => {\r\n        content.classList.toggle('active', content.id === tab);\r\n    });\r\n\r\n    state.currentTab = tab;\r\n\r\n    // Emit custom event for tab-specific loading\r\n    const event = new CustomEvent('tabChanged', { detail: { tab } });\r\n    document.dispatchEvent(event);\r\n}\r\n\r\n// ================================================\r\n// GOLD DISPLAY\r\n// ================================================\r\n\r\n/**\r\n * Format gold amount for display\r\n * @param {number} amount - The gold amount to format\r\n * @param {boolean} [compact=true] - Whether to use compact notation (1K, 1M)\r\n * @returns {string} Formatted gold string\r\n * @example\r\n * formatGold(1500, true);  // Returns \"1.5K\"\r\n * formatGold(1500, false); // Returns \"1,500\"\r\n */\r\nexport function formatGold(amount, compact = true) {\r\n    if (!compact) {\r\n        return amount.toLocaleString();\r\n    }\r\n\r\n    if (amount >= 1000000) {\r\n        return (amount / 1000000).toFixed(1) + 'M';\r\n    } else if (amount >= 1000) {\r\n        return (amount / 1000).toFixed(1) + 'K';\r\n    }\r\n    return amount.toLocaleString();\r\n}\r\n\r\n/**\r\n * Update the gold display in the UI\r\n * @param {number} [gold] - Optional gold amount. If not provided, fetches from server\r\n * @returns {void}\r\n */\r\nexport function updateGoldDisplay(gold) {\r\n    const goldEl = document.getElementById('user-gold');\r\n    if (!goldEl) return;\r\n\r\n    if (gold !== undefined) {\r\n        goldEl.textContent = formatGold(gold, state.isGoldCompact);\r\n        goldEl.dataset.fullAmount = gold;\r\n    } else {\r\n        fetch(`${API_BASE}?action=get_shop`)\r\n            .then(r => r.json())\r\n            .then(d => {\r\n                if (d.user_gold !== undefined) {\r\n                    goldEl.textContent = formatGold(d.user_gold, state.isGoldCompact);\r\n                    goldEl.dataset.fullAmount = d.user_gold;\r\n                }\r\n            });\r\n    }\r\n}\r\n\r\n/**\r\n * Initialize gold display toggle (compact/full format on click)\r\n * @returns {void}\r\n */\r\nexport function initGoldToggle() {\r\n    const goldEl = document.getElementById('user-gold');\r\n    if (goldEl) {\r\n        goldEl.style.cursor = 'pointer';\r\n        goldEl.title = 'Click to toggle format';\r\n\r\n        goldEl.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n            state.isGoldCompact = !state.isGoldCompact;\r\n\r\n            const amount = parseInt(goldEl.dataset.fullAmount || 0);\r\n            goldEl.textContent = formatGold(amount, state.isGoldCompact);\r\n\r\n            goldEl.style.transform = 'scale(1.1)';\r\n            setTimeout(() => {\r\n                goldEl.style.transform = 'scale(1)';\r\n            }, 150);\r\n        });\r\n    }\r\n}\r\n\r\n// ================================================\r\n// URL ERROR CHECKING\r\n// ================================================\r\n\r\n/**\r\n * Check URL parameters for error messages and display appropriate toasts\r\n * @returns {void}\r\n */\r\nexport function checkUrlErrors() {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const error = urlParams.get('error');\r\n\r\n    if (error === 'battle_limit') {\r\n        showToast('You have used all 3 daily battles! Come back tomorrow.', 'warning');\r\n        window.history.replaceState({}, document.title, window.location.pathname);\r\n    } else if (error === 'missing_pets') {\r\n        showToast('Invalid battle parameters', 'error');\r\n        window.history.replaceState({}, document.title, window.location.pathname);\r\n    }\r\n}\r\n\r\n// ================================================\r\n// DAILY LOGIN REWARD SYSTEM\r\n// ================================================\r\n\r\n/**\r\n * Check if daily reward is available and show modal if claimable\r\n * @async\r\n * @returns {Promise<void>}\r\n */\r\nexport async function checkDailyReward() {\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=get_daily_reward`);\r\n        const data = await response.json();\r\n\r\n        if (data.success && data.can_claim) {\r\n            state.dailyRewardData = data;\r\n            showDailyRewardModal(data);\r\n        }\r\n    } catch (error) {\r\n        console.error('Error checking daily reward:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Display the daily login reward modal\r\n * @param {Object} data - Daily reward data from API\r\n * @param {number} data.current_day - Current streak day (1-30)\r\n * @param {number} data.total_logins - Total login count\r\n * @param {number} data.reward_gold - Gold reward amount\r\n * @param {string} [data.reward_item_name] - Optional item reward name\r\n * @returns {void}\r\n */\r\nexport function showDailyRewardModal(data) {\r\n    const modal = document.getElementById('daily-login-modal');\r\n    const calendar = document.getElementById('daily-calendar');\r\n    const currentDayEl = document.getElementById('daily-current-day');\r\n    const rewardText = document.getElementById('daily-reward-text');\r\n    const totalLogins = document.getElementById('daily-total-logins');\r\n\r\n    if (!modal || !calendar) return;\r\n\r\n    currentDayEl.textContent = data.current_day;\r\n    totalLogins.textContent = data.total_logins;\r\n\r\n    let rewardStr = '';\r\n    if (data.reward_gold > 0) {\r\n        rewardStr += `${data.reward_gold} Gold`;\r\n    }\r\n    if (data.reward_item_name) {\r\n        rewardStr += (rewardStr ? ' + ' : '') + `1 ${data.reward_item_name}`;\r\n    }\r\n    rewardText.textContent = rewardStr;\r\n\r\n    let calendarHTML = '';\r\n    const specialDays = [7, 14, 21, 28, 30];\r\n\r\n    for (let day = 1; day <= 30; day++) {\r\n        let classes = 'calendar-day';\r\n        let icon = 'üí∞';\r\n\r\n        if (day < data.current_day) {\r\n            classes += ' claimed';\r\n            icon = '‚úì';\r\n        } else if (day === data.current_day) {\r\n            classes += ' current';\r\n            icon = 'üéÅ';\r\n        }\r\n\r\n        if (specialDays.includes(day)) {\r\n            classes += ' special';\r\n            if (day !== data.current_day && day > data.current_day) {\r\n                icon = '‚≠ê';\r\n            }\r\n        }\r\n\r\n        calendarHTML += `\r\n            <div class=\"${classes}\">\r\n                <span class=\"day-num\">${day}</span>\r\n                <span class=\"day-icon\">${icon}</span>\r\n            </div>\r\n        `;\r\n    }\r\n    calendar.innerHTML = calendarHTML;\r\n\r\n    modal.classList.add('show');\r\n}\r\n\r\n/**\r\n * Claim the daily login reward\r\n * @async\r\n * @returns {Promise<void>}\r\n */\r\nexport async function claimDailyReward() {\r\n    const btn = document.getElementById('claim-reward-btn');\r\n    btn.disabled = true;\r\n    btn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Claiming...';\r\n\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=claim_daily_reward`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.success) {\r\n            let message = `Day ${data.claimed_day} reward claimed!`;\r\n            if (data.gold_received > 0) {\r\n                message += ` +${data.gold_received} Gold`;\r\n            }\r\n            if (data.item_received) {\r\n                message += ` +1 ${data.item_received}`;\r\n            }\r\n\r\n            showToast(message, 'success');\r\n            closeDailyModal();\r\n            updateGoldDisplay();\r\n        } else {\r\n            showToast(data.error || 'Failed to claim reward', 'error');\r\n            btn.disabled = false;\r\n            btn.innerHTML = '<i class=\"fas fa-gift\"></i> Claim Reward!';\r\n        }\r\n    } catch (error) {\r\n        console.error('Error claiming daily reward:', error);\r\n        showToast('Network error', 'error');\r\n        btn.disabled = false;\r\n        btn.innerHTML = '<i class=\"fas fa-gift\"></i> Claim Reward!';\r\n    }\r\n}\r\n\r\n/**\r\n * Close the daily login reward modal\r\n * @returns {void}\r\n */\r\nexport function closeDailyModal() {\r\n    document.getElementById('daily-login-modal').classList.remove('show');\r\n}\r\n","/**\r\n * Pet Management Module\r\n * @module pet/pets\r\n * @description Handles pet loading, display, actions, and utility functions\r\n * \r\n * @author MOE Development Team\r\n * @version 2.0.0\r\n */\r\n\r\nimport { API_BASE, ASSETS_BASE } from './config.js';\r\nimport { state } from './state.js';\r\nimport { showToast, switchTab } from './ui.js';\r\n\r\n// ================================================\r\n// PET LOADING\r\n// ================================================\r\n\r\n/**\r\n * Load all pets owned by the current user\r\n * @async\r\n * @fires petsLoaded - Custom event dispatched when pets are loaded\r\n * @returns {Promise<void>}\r\n */\r\nexport async function loadPets() {\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=get_pets`);\r\n        const data = await response.json();\r\n\r\n        if (data.success) {\r\n            state.userPets = data.pets;\r\n            window.userPets = state.userPets; // Backward compatibility\r\n\r\n            updatePetCountBadge();\r\n\r\n            // Emit event for collection rendering\r\n            document.dispatchEvent(new CustomEvent('petsLoaded'));\r\n\r\n            // Find and display active pet\r\n            state.activePet = state.userPets.find(p => p.is_active);\r\n            window.activePet = state.activePet; // Backward compatibility\r\n\r\n            if (state.activePet) {\r\n                renderActivePet();\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.error('Error loading pets:', error);\r\n        showToast('Failed to load pets', 'error');\r\n    }\r\n}\r\n\r\n/**\r\n * Load the user's currently active pet\r\n * @async\r\n * @returns {Promise<void>}\r\n */\r\nexport async function loadActivePet() {\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=get_active_pet`);\r\n        const data = await response.json();\r\n\r\n        if (data.success && data.pet) {\r\n            state.activePet = data.pet;\r\n            window.activePet = state.activePet;\r\n            renderActivePet();\r\n\r\n            // Load pet into PixiJS if available\r\n            if (window.PixiPet && window.PixiPet.isReady()) {\r\n                window.PixiPet.load(state.activePet);\r\n            }\r\n        } else {\r\n            showNoPetMessage();\r\n        }\r\n    } catch (error) {\r\n        console.error('Error loading active pet:', error);\r\n    }\r\n}\r\n\r\n// ================================================\r\n// PET DISPLAY\r\n// ================================================\r\n\r\n/**\r\n * Render the active pet in the My Pet tab\r\n * Updates pet image, stats, exp bar, and action buttons\r\n * @returns {void}\r\n */\r\nexport function renderActivePet() {\r\n    const noPetMsg = document.getElementById('no-pet-message');\r\n    const petZone = document.getElementById('pet-display-zone');\r\n    const infoHeader = document.getElementById('pet-info-header');\r\n    const statsContainer = document.getElementById('stats-container');\r\n    const expCard = document.getElementById('exp-card');\r\n    const actions = document.getElementById('action-buttons');\r\n\r\n    if (!state.activePet) {\r\n        showNoPetMessage();\r\n        return;\r\n    }\r\n\r\n    noPetMsg.style.display = 'none';\r\n    petZone.style.display = 'block';\r\n\r\n    const imgPath = getPetImagePath(state.activePet);\r\n    const shinyStyle = state.activePet.is_shiny ? `filter: hue-rotate(${state.activePet.shiny_hue}deg);` : '';\r\n\r\n    const petContainer = document.getElementById('pet-img-container');\r\n    petContainer.innerHTML = `\r\n        <img src=\"${imgPath}\" alt=\"${state.activePet.species_name}\" \r\n             class=\"pet-image pet-anim-idle\" \r\n             style=\"${shinyStyle}; width: 180px; height: 180px; object-fit: contain; filter: drop-shadow(0 8px 25px rgba(0,0,0,0.6));\"\r\n             onerror=\"this.src='../assets/placeholder.png'\">\r\n    `;\r\n\r\n    const shinySparkles = document.getElementById('shiny-sparkles');\r\n    shinySparkles.style.display = state.activePet.is_shiny ? 'block' : 'none';\r\n\r\n    infoHeader.style.display = 'block';\r\n\r\n    const displayName = state.activePet.nickname || state.activePet.species_name;\r\n    document.getElementById('pet-name').textContent = displayName;\r\n    document.getElementById('pet-level').textContent = `Lv.${state.activePet.level}`;\r\n\r\n    const elementBadge = document.getElementById('pet-element-badge');\r\n    elementBadge.textContent = state.activePet.element;\r\n    elementBadge.className = `element-badge ${state.activePet.element.toLowerCase()}`;\r\n\r\n    const rarityBadge = document.getElementById('pet-rarity-badge');\r\n    rarityBadge.textContent = state.activePet.rarity;\r\n    rarityBadge.className = `rarity-badge ${state.activePet.rarity.toLowerCase()}`;\r\n\r\n    const shinyTag = document.getElementById('shiny-tag');\r\n    shinyTag.style.display = state.activePet.is_shiny ? 'inline-flex' : 'none';\r\n\r\n    statsContainer.style.display = 'grid';\r\n\r\n    updateCircularProgress('health', state.activePet.health);\r\n    updateCircularProgress('hunger', state.activePet.hunger);\r\n    updateCircularProgress('mood', state.activePet.mood);\r\n\r\n    expCard.style.display = 'block';\r\n    const expNeeded = Math.floor(100 * Math.pow(1.2, state.activePet.level - 1));\r\n    const expPercent = (state.activePet.exp / expNeeded) * 100;\r\n    document.getElementById('exp-bar').style.width = `${expPercent}%`;\r\n    document.getElementById('exp-text').textContent = `${state.activePet.exp} / ${expNeeded}`;\r\n\r\n    actions.style.display = 'grid';\r\n\r\n    const shelterBtn = document.getElementById('btn-shelter');\r\n    if (shelterBtn) {\r\n        const labelEl = shelterBtn.querySelector('.action-label');\r\n        const iconEl = shelterBtn.querySelector('i');\r\n        if (state.activePet.status === 'SHELTER') {\r\n            if (labelEl) labelEl.textContent = 'Retrieve';\r\n            if (iconEl) iconEl.className = 'fas fa-door-open';\r\n        } else {\r\n            if (labelEl) labelEl.textContent = 'Shelter';\r\n            if (iconEl) iconEl.className = 'fas fa-home';\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Update a circular progress ring element\r\n * @param {'health'|'hunger'|'mood'} type - The stat type to update\r\n * @param {number} value - The current value (0-100)\r\n * @returns {void}\r\n */\r\nexport function updateCircularProgress(type, value) {\r\n    const ring = document.getElementById(`${type}-ring`);\r\n    const valueEl = document.getElementById(`${type}-value`);\r\n\r\n    if (!ring || !valueEl) return;\r\n\r\n    valueEl.textContent = Math.round(value);\r\n    const circumference = 220;\r\n    const offset = circumference - (value / 100) * circumference;\r\n    ring.style.strokeDashoffset = offset;\r\n}\r\n\r\n/**\r\n * Show message when user has no active pet\r\n * @returns {void}\r\n */\r\nexport function showNoPetMessage() {\r\n    const stage = document.getElementById('pet-stage');\r\n    stage.innerHTML = `\r\n        <div class=\"no-pet-message\">\r\n            <i class=\"fas fa-egg fa-3x\"></i>\r\n            <p>No active pet!</p>\r\n            <button class=\"action-btn primary\" onclick=\"switchTab('gacha')\">\r\n                Get Your First Pet\r\n            </button>\r\n        </div>\r\n    `;\r\n\r\n    document.getElementById('pet-info').style.display = 'none';\r\n    document.getElementById('action-buttons').style.display = 'none';\r\n}\r\n\r\n// ================================================\r\n// PET ACTIONS\r\n// ================================================\r\n\r\n/**\r\n * Select a pet to make it active\r\n * @async\r\n * @param {number} petId - The ID of the pet to select\r\n * @returns {Promise<void>}\r\n */\r\nexport async function selectPet(petId) {\r\n    const pet = state.userPets.find(p => p.id === petId);\r\n    if (!pet) return;\r\n\r\n    if (pet.status === 'DEAD') {\r\n        showToast('This pet is dead! Use a revival item first.', 'warning');\r\n        return;\r\n    }\r\n\r\n    if (pet.status === 'SHELTER') {\r\n        if (confirm(`Retrieve ${pet.nickname || pet.species_name} from shelter?`)) {\r\n            toggleShelter(petId);\r\n        }\r\n        return;\r\n    }\r\n\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=set_active`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ pet_id: petId })\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.success) {\r\n            showToast('Pet is now active!', 'success');\r\n            await loadPets();\r\n            switchTab('my-pet');\r\n        } else {\r\n            showToast(data.error || 'Failed to set active pet', 'error');\r\n        }\r\n    } catch (error) {\r\n        console.error('Error setting active pet:', error);\r\n        showToast('Network error', 'error');\r\n    }\r\n}\r\n\r\n/**\r\n * Initialize action button event listeners\r\n * @returns {void}\r\n */\r\nexport function initActionButtons() {\r\n    document.getElementById('btn-feed')?.addEventListener('click', () => {\r\n        document.dispatchEvent(new CustomEvent('openItemModal', { detail: { type: 'food' } }));\r\n    });\r\n    document.getElementById('btn-heal')?.addEventListener('click', () => {\r\n        document.dispatchEvent(new CustomEvent('openItemModal', { detail: { type: 'potion' } }));\r\n    });\r\n    document.getElementById('btn-play')?.addEventListener('click', playWithPet);\r\n    document.getElementById('btn-shelter')?.addEventListener('click', () => toggleShelter());\r\n}\r\n\r\n/**\r\n * Play with the active pet (triggers mini-game)\r\n * @async\r\n * @returns {Promise<void>}\r\n */\r\nexport async function playWithPet() {\r\n    if (!state.activePet) return;\r\n\r\n    if (state.activePet.status === 'DEAD') {\r\n        showToast('This pet is dead! Use a revival item first.', 'warning');\r\n        return;\r\n    }\r\n\r\n    if (window.PetAnimations) {\r\n        window.PetAnimations.jump();\r\n        window.PetAnimations.hearts(3);\r\n    }\r\n\r\n    showToast('You played with ' + (state.activePet.nickname || state.activePet.species_name) + '! üéµ', 'success');\r\n\r\n    setTimeout(() => {\r\n        const rhythmModal = document.getElementById('rhythm-modal');\r\n        if (rhythmModal) {\r\n            rhythmModal.classList.add('show');\r\n            if (typeof startRhythmGame === 'function') {\r\n                startRhythmGame();\r\n            }\r\n        }\r\n    }, 500);\r\n}\r\n\r\n/**\r\n * Toggle pet shelter status (protect from stat decay)\r\n * @async\r\n * @param {number|null} [targetPetId=null] - Pet ID to toggle, or null for active pet\r\n * @returns {Promise<void>}\r\n */\r\nexport async function toggleShelter(targetPetId = null) {\r\n    const petId = targetPetId || (state.activePet ? state.activePet.id : null);\r\n    if (!petId) return;\r\n\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=shelter`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ pet_id: petId })\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.success) {\r\n            showToast(data.message, 'success');\r\n            loadActivePet();\r\n            loadPets();\r\n        } else {\r\n            showToast(data.error || 'Failed to toggle shelter', 'error');\r\n        }\r\n    } catch (error) {\r\n        console.error('Error toggling shelter:', error);\r\n    }\r\n}\r\n\r\n// ================================================\r\n// UTILITY FUNCTIONS\r\n// ================================================\r\n\r\n/**\r\n * Get the image path for a pet based on its evolution stage\r\n * @param {Object} pet - The pet object\r\n * @param {string} pet.evolution_stage - Current evolution stage ('egg', 'baby', 'adult')\r\n * @param {string} [pet.img_egg] - Egg stage image path\r\n * @param {string} [pet.img_baby] - Baby stage image path\r\n * @param {string} [pet.img_adult] - Adult stage image path\r\n * @returns {string} Full image URL path\r\n */\r\nexport function getPetImagePath(pet) {\r\n    const stage = pet.evolution_stage || 'egg';\r\n\r\n    let imgKeys;\r\n    switch (stage) {\r\n        case 'egg':\r\n            imgKeys = ['img_egg', 'img_baby', 'img_adult'];\r\n            break;\r\n        case 'baby':\r\n            imgKeys = ['img_baby', 'img_egg', 'img_adult'];\r\n            break;\r\n        case 'adult':\r\n            imgKeys = ['img_adult', 'img_baby', 'img_egg'];\r\n            break;\r\n        default:\r\n            imgKeys = ['img_egg', 'img_baby', 'img_adult'];\r\n    }\r\n\r\n    for (const key of imgKeys) {\r\n        if (pet[key] && pet[key] !== '' && pet[key] !== null) {\r\n            return ASSETS_BASE + pet[key];\r\n        }\r\n    }\r\n\r\n    return ASSETS_BASE + (pet.current_image || 'default/egg.png');\r\n}\r\n\r\n/**\r\n * Get the evolution stage of a pet\r\n * @param {Object|*} pet - The pet object or value\r\n * @returns {'egg'|'baby'|'adult'} The evolution stage\r\n */\r\nexport function getEvolutionStage(pet) {\r\n    if (typeof pet === 'object' && pet !== null) {\r\n        return pet.evolution_stage || 'egg';\r\n    }\r\n    return 'egg';\r\n}\r\n\r\n/**\r\n * Update the pet count badge display\r\n * @returns {void}\r\n */\r\nexport function updatePetCountBadge() {\r\n    const petCountBadge = document.getElementById('pet-count-badge');\r\n    if (petCountBadge) {\r\n        const petCount = state.userPets.length;\r\n        petCountBadge.textContent = `${petCount} / 25`;\r\n\r\n        if (petCount >= 25) {\r\n            petCountBadge.style.background = 'linear-gradient(135deg, #E74C3C, #C0392B)';\r\n        } else if (petCount >= 20) {\r\n            petCountBadge.style.background = 'linear-gradient(135deg, #F39C12, #E67E22)';\r\n        } else {\r\n            petCountBadge.style.background = 'linear-gradient(135deg, var(--gold), var(--gold-dark))';\r\n        }\r\n    }\r\n}\r\n","/**\r\n * Collection Rendering Module\r\n * MOE Pet System\r\n * \r\n * Handles the collection tab display\r\n */\r\n\r\nimport { state } from './state.js';\r\nimport { getPetImagePath, updatePetCountBadge } from './pets.js';\r\n\r\nexport function renderCollection() {\r\n    const grid = document.getElementById('collection-grid');\r\n\r\n    updatePetCountBadge();\r\n\r\n    // Update stats panel if available\r\n    if (typeof updateCollectionStats === 'function') {\r\n        updateCollectionStats();\r\n    }\r\n\r\n    if (state.userPets.length === 0) {\r\n        grid.innerHTML = `\r\n            <div class=\"empty-message\">\r\n                <p>No pets yet! Visit the Gacha tab to get your first companion.</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n\r\n    // Get filtered pets if filter function exists\r\n    const displayPets = typeof getFilteredPets === 'function' ? getFilteredPets() : state.userPets;\r\n\r\n    if (displayPets.length === 0) {\r\n        grid.innerHTML = `\r\n            <div class=\"empty-message\">\r\n                <p>No pets match your search or filter.</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n\r\n    grid.innerHTML = displayPets.map(pet => {\r\n        const imgPath = getPetImagePath(pet);\r\n        const displayName = pet.nickname || pet.species_name;\r\n        const activeClass = pet.is_active ? 'active' : '';\r\n        const deadClass = pet.status === 'DEAD' ? 'dead' : '';\r\n        const shinyStyle = pet.is_shiny ? `filter: hue-rotate(${pet.shiny_hue}deg);` : '';\r\n\r\n        const elementIcons = {\r\n            'Fire': 'üî•',\r\n            'Water': 'üíß',\r\n            'Earth': 'üåø',\r\n            'Air': 'üí®'\r\n        };\r\n        const elementIcon = elementIcons[pet.element] || '‚≠ê';\r\n\r\n        let actionButtonHTML = '';\r\n        if (pet.status === 'SHELTER') {\r\n            actionButtonHTML = `\r\n                <button class=\"shop-buy-btn\" onclick=\"event.stopPropagation(); selectPet(${pet.id})\">\r\n                    <i class=\"fas fa-box-open\"></i> Retrieve\r\n                </button>\r\n            `;\r\n        }\r\n\r\n        return `\r\n            <div class=\"pet-card ${activeClass} ${deadClass}\" onclick=\"selectPet(${pet.id})\">\r\n                <span class=\"rarity-badge ${pet.rarity.toLowerCase()}\">${pet.rarity}</span>\r\n                <div class=\"pet-card-element ${pet.element.toLowerCase()}\" title=\"${pet.element}\">\r\n                    ${elementIcon}\r\n                </div>\r\n                ${pet.is_shiny ? '<div class=\"pet-card-shiny\">‚ú®</div>' : ''}\r\n                <img src=\"${imgPath}\" alt=\"${pet.species_name}\" class=\"pet-card-img\" \r\n                     style=\"${shinyStyle}\"\r\n                     onerror=\"this.src='../assets/placeholder.png'\">\r\n                <h3 class=\"pet-card-name\">${displayName}</h3>\r\n                <span class=\"pet-card-level\">Lv.${pet.level}</span>\r\n                ${actionButtonHTML}\r\n            </div>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\n// Listen for pets loaded event\r\ndocument.addEventListener('petsLoaded', () => {\r\n    renderCollection();\r\n});\r\n","/**\r\n * Inventory & Item Usage Module\r\n * MOE Pet System\r\n * \r\n * Handles inventory display, item usage, and revive system\r\n */\r\n\r\nimport { API_BASE, ASSETS_BASE } from './config.js';\r\nimport { state } from './state.js';\r\nimport { showToast, updateGoldDisplay } from './ui.js';\r\nimport { loadPets, loadActivePet, getPetImagePath } from './pets.js';\r\n\r\n// ================================================\r\n// INVENTORY LOADING & DISPLAY\r\n// ================================================\r\n\r\nexport async function loadInventory() {\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=get_inventory`);\r\n        const data = await response.json();\r\n\r\n        if (data.success) {\r\n            state.userInventory = data.inventory;\r\n            renderInventory();\r\n            updateInventoryCount();\r\n        }\r\n    } catch (error) {\r\n        console.error('Error loading inventory:', error);\r\n    }\r\n}\r\n\r\nexport function renderInventory() {\r\n    const grid = document.getElementById('inventory-grid');\r\n\r\n    updateInventoryCount();\r\n\r\n    if (state.userInventory.length === 0) {\r\n        grid.innerHTML = '<p class=\"empty-message\">No items yet</p>';\r\n        return;\r\n    }\r\n\r\n    grid.innerHTML = state.userInventory.map(item => {\r\n        let rarity = 'common';\r\n        if (item.price) {\r\n            if (item.price >= 1000) rarity = 'legendary';\r\n            else if (item.price >= 500) rarity = 'epic';\r\n            else if (item.price >= 200) rarity = 'rare';\r\n            else if (item.price >= 100) rarity = 'uncommon';\r\n        }\r\n\r\n        const isDepleted = item.quantity === 0;\r\n\r\n        return `\r\n        <div class=\"inventory-item-card ${rarity} ${isDepleted ? 'depleted' : ''}\" \r\n             onclick=\"${!isDepleted ? `handleInventoryClick(\r\n                 ${item.item_id}, \r\n                 '${item.effect_type}', \r\n                 '${item.name.replace(/'/g, \"\\\\'\")}', \r\n                 '${item.description ? item.description.replace(/'/g, \"\\\\'\") : ''}', \r\n                 '${item.img_path}', \r\n                 ${item.quantity}\r\n             )` : 'void(0)'}\" \r\n             title=\"${item.name}${item.description ? ' - ' + item.description : ''}\">\r\n            <div class=\"inventory-item-img-wrapper\">\r\n                <img src=\"${ASSETS_BASE}${item.img_path}\" alt=\"${item.name}\"\r\n                     onerror=\"this.src='../assets/placeholder.png'\">\r\n            </div>\r\n            <span class=\"inventory-qty-badge\">${item.quantity}</span>\r\n            <p class=\"inventory-item-name\">${item.name}</p>\r\n        </div>\r\n    `;\r\n    }).join('');\r\n}\r\n\r\nexport function updateInventoryCount() {\r\n    const countEl = document.getElementById('inventory-count');\r\n    if (countEl) {\r\n        const count = state.userInventory.length;\r\n        countEl.textContent = `${count} ${count === 1 ? 'item' : 'items'}`;\r\n    }\r\n}\r\n\r\n// ================================================\r\n// ITEM CLICK HANDLING\r\n// ================================================\r\n\r\nexport async function handleInventoryClick(itemId, type, itemName, itemDesc, itemImg, maxQty) {\r\n    // Gacha Ticket handling\r\n    if (type === 'gacha_ticket') {\r\n        if (confirm(`Apakah kamu ingin menetaskan ${itemName} sekarang?`)) {\r\n            useItem(itemId, 0, 1);\r\n        }\r\n        return;\r\n    }\r\n\r\n    // Revive items handling\r\n    if (type === 'revive') {\r\n        openReviveModal(itemId, itemName, itemImg);\r\n        return;\r\n    }\r\n\r\n    // Check for active pet\r\n    if (!state.activePet) {\r\n        showToast('Kamu butuh Active Pet untuk menggunakan item ini!', 'warning');\r\n        return;\r\n    }\r\n    if (state.activePet.status === 'DEAD') {\r\n        showToast('Pet mati. Hidupkan dulu dengan item Revive!', 'error');\r\n        return;\r\n    }\r\n\r\n    // Open bulk use modal\r\n    state.currentBulkItem = {\r\n        id: itemId,\r\n        max: maxQty,\r\n        name: itemName\r\n    };\r\n\r\n    const modal = document.getElementById('bulk-use-modal');\r\n    if (!modal) {\r\n        if (confirm(`Gunakan ${itemName}?`)) useItem(itemId, state.activePet.id, 1);\r\n        return;\r\n    }\r\n\r\n    document.getElementById('bulk-modal-title').textContent = itemName;\r\n    document.getElementById('bulk-item-desc').textContent = itemDesc;\r\n    document.getElementById('bulk-item-img').src = ASSETS_BASE + itemImg;\r\n    document.getElementById('bulk-item-qty').max = maxQty;\r\n    document.getElementById('bulk-item-qty').value = 1;\r\n\r\n    modal.classList.add('show');\r\n}\r\n\r\n// ================================================\r\n// BULK USE MODAL CONTROLS\r\n// ================================================\r\n\r\nexport function adjustQty(amount) {\r\n    const input = document.getElementById('bulk-item-qty');\r\n    let val = parseInt(input.value) + amount;\r\n\r\n    if (val < 1) val = 1;\r\n    if (val > state.currentBulkItem.max) val = state.currentBulkItem.max;\r\n\r\n    input.value = val;\r\n}\r\n\r\nexport function setMaxQty() {\r\n    document.getElementById('bulk-item-qty').value = state.currentBulkItem.max;\r\n}\r\n\r\nexport function closeBulkModal() {\r\n    document.getElementById('bulk-use-modal').classList.remove('show');\r\n    state.currentBulkItem = null;\r\n}\r\n\r\nexport function confirmBulkUse() {\r\n    if (!state.currentBulkItem || !state.activePet) return;\r\n\r\n    const qty = parseInt(document.getElementById('bulk-item-qty').value);\r\n    useItem(state.currentBulkItem.id, state.activePet.id, qty);\r\n    closeBulkModal();\r\n}\r\n\r\n// ================================================\r\n// ITEM USAGE API\r\n// ================================================\r\n\r\nexport async function useItem(itemId, targetPetId = 0, quantity = 1) {\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=use_item`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                pet_id: targetPetId,\r\n                item_id: itemId,\r\n                quantity: quantity\r\n            })\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.success) {\r\n            if (data.is_gacha && data.gacha_data) {\r\n                document.dispatchEvent(new CustomEvent('showGachaResult', { detail: data.gacha_data }));\r\n                showToast('Telur berhasil menetas!', 'success');\r\n            } else {\r\n                if (window.PetAnimations) {\r\n                    if (data.effect_type === 'food' || data.hunger_restored) {\r\n                        window.PetAnimations.food(quantity);\r\n                        window.PetAnimations.jump();\r\n                    } else if (data.effect_type === 'potion' || data.health_restored) {\r\n                        window.PetAnimations.sparkles(6);\r\n                        window.PetAnimations.lottie('healing', 1500);\r\n                    } else if (data.effect_type === 'revive') {\r\n                        window.PetAnimations.revive();\r\n                        window.PetAnimations.lottie('sparkles', 2000);\r\n                    }\r\n\r\n                    if (data.exp_gained && data.exp_gained > 0) {\r\n                        window.PetAnimations.showExp(data.exp_gained);\r\n                    }\r\n                }\r\n\r\n                showToast(data.message, 'success');\r\n            }\r\n\r\n            if (document.getElementById('item-modal')) closeItemModal();\r\n\r\n            loadActivePet();\r\n            loadInventory();\r\n            loadPets();\r\n        } else {\r\n            showToast(data.error || 'Failed to use item', 'error');\r\n        }\r\n    } catch (error) {\r\n        console.error('Error using item:', error);\r\n    }\r\n}\r\n\r\n// ================================================\r\n// QUICK USE MODAL\r\n// ================================================\r\n\r\nexport function openItemModal(type) {\r\n    if (!state.activePet) return;\r\n\r\n    state.selectedItemType = type;\r\n    const modal = document.getElementById('item-modal');\r\n    const list = document.getElementById('item-list');\r\n\r\n    const items = state.userInventory.filter(item => item.effect_type === type);\r\n\r\n    if (items.length === 0) {\r\n        list.innerHTML = `<div class=\"empty-message\">No items! Visit shop.</div>`;\r\n    } else {\r\n        list.innerHTML = items.map(item => `\r\n            <div class=\"item-option\" onclick=\"useItem(${item.item_id}, ${state.activePet.id}, 1)\">\r\n                <img src=\"${ASSETS_BASE}${item.img_path}\" onerror=\"this.src='../assets/placeholder.png'\">\r\n                <div class=\"item-option-name\">${item.name}</div>\r\n                <div class=\"item-option-qty\">x${item.quantity}</div>\r\n            </div>\r\n        `).join('');\r\n    }\r\n\r\n    modal.classList.add('show');\r\n}\r\n\r\nexport function closeItemModal() {\r\n    document.getElementById('item-modal').classList.remove('show');\r\n    state.selectedItemType = null;\r\n}\r\n\r\n// ================================================\r\n// REVIVE SYSTEM\r\n// ================================================\r\n\r\nexport function openReviveModal(itemId, itemName, itemImg) {\r\n    state.currentReviveItem = state.userInventory.find(i => i.item_id === itemId);\r\n    if (!state.currentReviveItem) {\r\n        showToast('Item not found', 'error');\r\n        return;\r\n    }\r\n\r\n    const deadPets = state.userPets.filter(pet => pet.status === 'DEAD');\r\n\r\n    if (deadPets.length === 0) {\r\n        showToast('No dead pets to revive!', 'info');\r\n        return;\r\n    }\r\n\r\n    const deadPetsList = document.getElementById('dead-pets-list');\r\n    deadPetsList.innerHTML = deadPets.map(pet => {\r\n        const imgPath = getPetImagePath(pet);\r\n        const displayName = pet.nickname || pet.species_name;\r\n\r\n        return `\r\n            <div class=\"dead-pet-card\" onclick=\"revivePet(${pet.id})\">\r\n                <img src=\"${imgPath}\" alt=\"${displayName}\" \r\n                     onerror=\"this.src='../assets/placeholder.png'\">\r\n                <div class=\"dead-overlay\"></div>\r\n                <p>${displayName}</p>\r\n                <span class=\"rarity-badge ${pet.rarity.toLowerCase()}\">${pet.rarity}</span>\r\n            </div>\r\n        `;\r\n    }).join('');\r\n\r\n    document.getElementById('revive-modal').classList.add('show');\r\n}\r\n\r\nexport function closeReviveModal() {\r\n    document.getElementById('revive-modal').classList.remove('show');\r\n    state.currentReviveItem = null;\r\n}\r\n\r\nexport async function revivePet(petId) {\r\n    if (!state.currentReviveItem) return;\r\n\r\n    await useItem(state.currentReviveItem.item_id, petId, 1);\r\n    closeReviveModal();\r\n}\r\n\r\n// Listen for openItemModal event from pets module\r\ndocument.addEventListener('openItemModal', (e) => {\r\n    openItemModal(e.detail.type);\r\n});\r\n","/**\r\n * Gacha System Module\r\n * @module pet/gacha\r\n * @description Handles gacha/summoning mechanics and result display\r\n * \r\n * @author MOE Development Team\r\n * @version 2.0.0\r\n */\r\n\r\nimport { API_BASE, ASSETS_BASE } from './config.js';\r\nimport { state } from './state.js';\r\nimport { showToast, updateGoldDisplay } from './ui.js';\r\nimport { loadPets } from './pets.js';\r\n\r\n// ================================================\r\n// GACHA ACTIONS\r\n// ================================================\r\n\r\n/**\r\n * Perform a gacha summon\r\n * @async\r\n * @param {'standard'|'premium'} type - The type of gacha to perform\r\n * @returns {Promise<void>}\r\n * @example\r\n * performGacha('standard');  // Costs 50 gold\r\n * performGacha('premium');   // Uses Premium Ticket, guaranteed Rare+\r\n */\r\nexport async function performGacha(type) {\r\n    const egg = document.getElementById('gacha-egg');\r\n    egg?.classList.add('hatching');\r\n\r\n    let gachaType = 'standard';\r\n    if (type === 'premium') {\r\n        gachaType = 'premium';\r\n    }\r\n\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=gacha`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ type: gachaType })\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        setTimeout(() => {\r\n            egg?.classList.remove('hatching');\r\n\r\n            if (data.success) {\r\n                showGachaResult(data);\r\n                updateGoldDisplay(data.remaining_gold);\r\n                loadPets();\r\n            } else {\r\n                showToast(data.error || 'Gacha failed', 'error');\r\n            }\r\n        }, 500);\r\n\r\n    } catch (error) {\r\n        console.error('Error performing gacha:', error);\r\n        egg?.classList.remove('hatching');\r\n        showToast('Network error', 'error');\r\n    }\r\n}\r\n\r\n/**\r\n * Display the gacha result in a modal\r\n * @param {Object} data - Gacha result data from API\r\n * @param {Object} data.species - The obtained pet species\r\n * @param {string} data.species.name - Species name\r\n * @param {string} data.species.img_egg - Egg stage image path\r\n * @param {string} data.species.element - Element type\r\n * @param {string} data.rarity - Rarity of obtained pet ('Common', 'Rare', 'Epic', 'Legendary')\r\n * @param {boolean} data.is_shiny - Whether the pet is shiny\r\n * @param {number} [data.shiny_hue] - Hue rotation for shiny pets (30-330)\r\n * @returns {void}\r\n */\r\nexport function showGachaResult(data) {\r\n    const modal = document.getElementById('gacha-modal');\r\n    const modalContent = modal?.querySelector('.gacha-result-modal');\r\n    const species = data.species;\r\n\r\n    if (!modal || !modalContent) return;\r\n\r\n    modalContent.classList.remove('rarity-common', 'rarity-rare', 'rarity-epic', 'rarity-legendary');\r\n    modalContent.classList.add(`rarity-${data.rarity.toLowerCase()}`);\r\n\r\n    document.getElementById('result-pet-img').src = ASSETS_BASE + (species.img_egg || 'default/egg.png');\r\n    document.getElementById('result-name').textContent = species.name;\r\n\r\n    const rarityBadge = document.getElementById('result-rarity');\r\n    rarityBadge.textContent = data.rarity;\r\n    rarityBadge.className = `rarity-badge-large ${data.rarity.toLowerCase()}`;\r\n\r\n    const elementEl = document.getElementById('result-element');\r\n    if (elementEl && species.element) {\r\n        elementEl.textContent = species.element;\r\n    }\r\n\r\n    const titleEl = document.getElementById('result-title');\r\n    const titles = {\r\n        'Common': 'New Pet!',\r\n        'Rare': 'Nice Pull!',\r\n        'Epic': 'Amazing!',\r\n        'Legendary': 'üéâ LEGENDARY! üéâ'\r\n    };\r\n    const titleText = titles[data.rarity] || 'Congratulations!';\r\n    titleEl.innerHTML = `<i class=\"fas fa-sparkles\"></i><span>${titleText}</span>`;\r\n\r\n    const shinyBadge = document.getElementById('result-shiny');\r\n    if (data.is_shiny) {\r\n        document.getElementById('result-pet-img').style.filter = `hue-rotate(${data.shiny_hue}deg) drop-shadow(0 10px 40px rgba(0, 0, 0, 0.6))`;\r\n        shinyBadge.style.display = 'flex';\r\n    } else {\r\n        document.getElementById('result-pet-img').style.filter = 'drop-shadow(0 10px 40px rgba(0, 0, 0, 0.6))';\r\n        shinyBadge.style.display = 'none';\r\n    }\r\n\r\n    modal.classList.add('show');\r\n\r\n    if (window.PetAnimations) {\r\n        const resultPet = document.getElementById('result-pet-img');\r\n        if (resultPet) {\r\n            resultPet.style.animation = 'none';\r\n            setTimeout(() => {\r\n                resultPet.style.animation = 'pet-reveal 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)';\r\n            }, 10);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Close the gacha result modal\r\n * @returns {void}\r\n */\r\nexport function closeGachaModal() {\r\n    const modal = document.getElementById('gacha-modal');\r\n    modal?.classList.remove('show');\r\n    loadPets();\r\n}\r\n\r\n// Listen for showGachaResult event from inventory module\r\ndocument.addEventListener('showGachaResult', (e) => {\r\n    showGachaResult(e.detail);\r\n});\r\n","/**\r\n * Shop System Module\r\n * @module pet/shop\r\n * @description Handles shop display, item purchasing, and shop category tabs\r\n * \r\n * @author MOE Development Team\r\n * @version 2.0.0\r\n */\r\n\r\nimport { API_BASE, ASSETS_BASE } from './config.js';\r\nimport { state } from './state.js';\r\nimport { showToast, updateGoldDisplay } from './ui.js';\r\nimport { loadInventory } from './inventory.js';\r\n\r\n// ================================================\r\n// SHOP INITIALIZATION\r\n// ================================================\r\n\r\n/**\r\n * Initialize shop tab navigation\r\n * @returns {void}\r\n */\r\nexport function initShopTabs() {\r\n    document.querySelectorAll('.shop-tab-pill').forEach(tab => {\r\n        tab.addEventListener('click', () => {\r\n            document.querySelectorAll('.shop-tab-pill').forEach(t => t.classList.remove('active'));\r\n            tab.classList.add('active');\r\n            renderShopItems(tab.dataset.shop);\r\n        });\r\n    });\r\n}\r\n\r\n// ================================================\r\n// SHOP LOADING\r\n// ================================================\r\n\r\n/**\r\n * Load shop items from the API\r\n * @async\r\n * @returns {Promise<void>}\r\n */\r\nexport async function loadShop() {\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=get_shop`);\r\n        const data = await response.json();\r\n\r\n        if (data.success) {\r\n            state.shopItems = data.items || [];\r\n            console.log('Shop loaded:', state.shopItems.length, 'items');\r\n            updateGoldDisplay(data.user_gold);\r\n            renderShopItems('food');\r\n        } else {\r\n            console.error('Shop load failed:', data.error);\r\n        }\r\n    } catch (error) {\r\n        console.error('Error loading shop:', error);\r\n    }\r\n}\r\n\r\n// ================================================\r\n// SHOP RENDERING\r\n// ================================================\r\n\r\n/**\r\n * Get the category for an item based on its effect type\r\n * @param {string} effectType - The item's effect type\r\n * @returns {'food'|'potion'|'special'} The item category\r\n */\r\nexport function getItemCategory(effectType) {\r\n    if (effectType === 'food') return 'food';\r\n    if (effectType === 'potion' || effectType === 'revive') return 'potion';\r\n    return 'special';\r\n}\r\n\r\n/**\r\n * Get the Font Awesome icon class for an item\r\n * @param {string} itemName - The item name\r\n * @param {string} effectType - The item's effect type\r\n * @returns {string} Font Awesome icon class (e.g., 'fa-drumstick-bite')\r\n */\r\nexport function getItemIcon(itemName, effectType) {\r\n    const name = itemName.toLowerCase();\r\n\r\n    // Food items\r\n    if (name.includes('kibble')) return 'fa-drumstick-bite';\r\n    if (name.includes('feast')) return 'fa-turkey';\r\n    if (name.includes('banquet')) return 'fa-crown';\r\n    if (name.includes('fish')) return 'fa-fish';\r\n    if (name.includes('meat')) return 'fa-bacon';\r\n\r\n    // Potions\r\n    if (name.includes('elixir')) return 'fa-flask';\r\n    if (name.includes('vitality')) return 'fa-heart-pulse';\r\n    if (name.includes('phoenix')) return 'fa-fire-flame-curved';\r\n    if (name.includes('tears')) return 'fa-droplet';\r\n    if (name.includes('health')) return 'fa-flask-vial';\r\n\r\n    // Special items\r\n    if (name.includes('exp') || name.includes('boost')) return 'fa-arrow-up';\r\n    if (name.includes('gacha') || name.includes('ticket')) return 'fa-ticket';\r\n    if (name.includes('shield')) return 'fa-shield-halved';\r\n    if (name.includes('star')) return 'fa-star';\r\n    if (name.includes('scroll')) return 'fa-scroll';\r\n    if (name.includes('soul')) return 'fa-ghost';\r\n    if (name.includes('ankh')) return 'fa-ankh';\r\n    if (name.includes('wisdom')) return 'fa-book';\r\n\r\n    // Category fallbacks\r\n    const category = getItemCategory(effectType);\r\n    if (category === 'food') return 'fa-drumstick-bite';\r\n    if (category === 'potion') return 'fa-flask';\r\n    return 'fa-star';\r\n}\r\n\r\n/**\r\n * Render shop items filtered by category\r\n * @param {'food'|'potion'|'special'} category - The category to filter by\r\n * @returns {void}\r\n */\r\nexport function renderShopItems(category) {\r\n    const grid = document.getElementById('shop-grid');\r\n\r\n    let filtered = state.shopItems;\r\n    if (category === 'food') {\r\n        filtered = state.shopItems.filter(i => i.effect_type === 'food');\r\n    } else if (category === 'potion') {\r\n        filtered = state.shopItems.filter(i => i.effect_type === 'potion' || i.effect_type === 'revive');\r\n    } else if (category === 'special') {\r\n        filtered = state.shopItems.filter(i => i.effect_type === 'exp_boost' || i.effect_type === 'gacha_ticket' || i.effect_type === 'shield');\r\n    }\r\n\r\n    if (filtered.length === 0) {\r\n        grid.innerHTML = '<div class=\"shop-empty\"><i class=\"fas fa-box-open\"></i><br>No items in this category</div>';\r\n        return;\r\n    }\r\n\r\n    grid.innerHTML = filtered.map(item => {\r\n        const icon = getItemIcon(item.name, item.effect_type);\r\n\r\n        let rarity = 'common';\r\n        if (item.price >= 1000) rarity = 'legendary';\r\n        else if (item.price >= 500) rarity = 'epic';\r\n        else if (item.price >= 200) rarity = 'rare';\r\n        else if (item.price >= 100) rarity = 'uncommon';\r\n\r\n        const isNew = item.is_new || false;\r\n\r\n        return `\r\n            <div class=\"shop-item-card ${rarity}\" onclick=\"buyItem(${item.id})\">\r\n                ${isNew ? '<span class=\"new-badge\">NEW</span>' : ''}\r\n                <div class=\"shop-item-icon-wrapper ${rarity}\">\r\n                    <i class=\"fas ${icon}\"></i>\r\n                </div>\r\n                <h4 class=\"shop-item-name\">${item.name}</h4>\r\n                <p class=\"shop-item-desc\">${item.description || ''}</p>\r\n                <div class=\"shop-item-footer\">\r\n                    <div class=\"shop-item-price\">\r\n                        <i class=\"fas fa-coins\"></i>\r\n                        <span>${item.price}</span>\r\n                    </div>\r\n                    <button class=\"shop-buy-btn\" onclick=\"event.stopPropagation(); buyItem(${item.id})\">\r\n                        <i class=\"fas fa-cart-plus\"></i>\r\n                        Buy\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\n// ================================================\r\n// PURCHASE MODAL\r\n// ================================================\r\n\r\n/**\r\n * Open the purchase modal for an item\r\n * @param {number} itemId - The ID of the item to purchase\r\n * @returns {void}\r\n */\r\nexport function buyItem(itemId) {\r\n    const searchId = parseInt(itemId);\r\n    const item = state.shopItems.find(i => parseInt(i.id) === searchId);\r\n    if (!item) {\r\n        console.log('shopItems:', state.shopItems, 'searching for:', searchId);\r\n        showToast('Item not found. Please refresh the page.', 'error');\r\n        return;\r\n    }\r\n\r\n    state.currentShopItem = item;\r\n\r\n    document.getElementById('shop-modal-img').src = ASSETS_BASE + (item.img_path || 'placeholder.png');\r\n    document.getElementById('shop-modal-name').textContent = item.name;\r\n    document.getElementById('shop-modal-desc').textContent = item.description;\r\n    document.getElementById('shop-unit-price').textContent = item.price;\r\n    document.getElementById('shop-qty-input').value = 1;\r\n    updateShopTotal();\r\n\r\n    document.getElementById('shop-purchase-modal').classList.add('show');\r\n}\r\n\r\n/**\r\n * Close the shop purchase modal\r\n * @returns {void}\r\n */\r\nexport function closeShopPurchaseModal() {\r\n    document.getElementById('shop-purchase-modal').classList.remove('show');\r\n    state.currentShopItem = null;\r\n}\r\n\r\n/**\r\n * Adjust the quantity in the shop purchase modal\r\n * @param {number} amount - Amount to adjust (positive or negative)\r\n * @returns {void}\r\n */\r\nexport function adjustShopQty(amount) {\r\n    const input = document.getElementById('shop-qty-input');\r\n    let value = parseInt(input.value) || 1;\r\n    value = Math.max(1, Math.min(99, value + amount));\r\n    input.value = value;\r\n    updateShopTotal();\r\n}\r\n\r\n/**\r\n * Update the total price display in the purchase modal\r\n * @returns {void}\r\n */\r\nexport function updateShopTotal() {\r\n    if (!state.currentShopItem) return;\r\n\r\n    const qty = parseInt(document.getElementById('shop-qty-input').value) || 1;\r\n    const total = qty * state.currentShopItem.price;\r\n    document.getElementById('shop-total-price').textContent = total.toLocaleString();\r\n}\r\n\r\n/**\r\n * Confirm and process the shop purchase\r\n * @async\r\n * @returns {Promise<void>}\r\n */\r\nexport async function confirmShopPurchase() {\r\n    if (!state.currentShopItem) return;\r\n\r\n    const quantity = parseInt(document.getElementById('shop-qty-input').value) || 1;\r\n\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=buy_item`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ item_id: state.currentShopItem.id, quantity: quantity })\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (data.success) {\r\n            showToast(data.message || `Purchased ${quantity}x ${state.currentShopItem.name}!`, 'success');\r\n            updateGoldDisplay(data.remaining_gold);\r\n            loadInventory();\r\n            closeShopPurchaseModal();\r\n        } else {\r\n            showToast(data.error || 'Purchase failed', 'error');\r\n        }\r\n    } catch (error) {\r\n        console.error('Error buying item:', error);\r\n        showToast('Network error', 'error');\r\n    }\r\n}\r\n","/**\r\n * Arena/Battle System Module\r\n * @module pet/arena\r\n * @description Handles arena opponents, battle history, and battle initiation\r\n * \r\n * @author MOE Development Team\r\n * @version 2.0.0\r\n */\r\n\r\nimport { API_BASE, ASSETS_BASE } from './config.js';\r\nimport { state } from './state.js';\r\nimport { showToast } from './ui.js';\r\n\r\n// ================================================\r\n// ARENA INITIALIZATION\r\n// ================================================\r\n\r\n/**\r\n * Initialize arena tab navigation (opponents vs history)\r\n * @returns {void}\r\n */\r\nexport function initArenaTabs() {\r\n    document.querySelectorAll('.arena-tab').forEach(tab => {\r\n        tab.addEventListener('click', () => {\r\n            document.querySelectorAll('.arena-tab').forEach(t => t.classList.remove('active'));\r\n            tab.classList.add('active');\r\n\r\n            const view = tab.dataset.view;\r\n            document.getElementById('arena-opponents').style.display = view === 'opponents' ? 'block' : 'none';\r\n            document.getElementById('arena-history').style.display = view === 'history' ? 'block' : 'none';\r\n\r\n            if (view === 'opponents') {\r\n                loadOpponents();\r\n            } else {\r\n                loadBattleHistory();\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n// ================================================\r\n// OPPONENTS\r\n// ================================================\r\n\r\n/**\r\n * Load available opponents for 1v1 battles\r\n * @async\r\n * @returns {Promise<void>}\r\n */\r\nexport async function loadOpponents() {\r\n    const container = document.getElementById('arena-opponents');\r\n    container.innerHTML = '<div class=\"loading-spinner\"><i class=\"fas fa-spinner fa-spin fa-2x\"></i><p>Finding opponents...</p></div>';\r\n\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=get_opponents`);\r\n        const data = await response.json();\r\n\r\n        if (data.success && data.opponents.length > 0) {\r\n            container.innerHTML = data.opponents.map(opp => `\r\n                <div class=\"opponent-card\">\r\n                    <img src=\"${ASSETS_BASE}${opp.img_adult}\" alt=\"${opp.species_name}\" class=\"opponent-img\"\r\n                         onerror=\"this.src='../assets/placeholder.png'\">\r\n                    <div class=\"opponent-info\">\r\n                        <h3 class=\"opponent-name\">${opp.display_name}</h3>\r\n                        <p class=\"opponent-owner\">Owner: ${opp.owner_name}</p>\r\n                        <div class=\"opponent-stats\">\r\n                            <span class=\"element-badge ${opp.element.toLowerCase()}\">${opp.element}</span>\r\n                            <span class=\"pet-level\">Lv.${opp.level}</span>\r\n                        </div>\r\n                    </div>\r\n                    <button class=\"battle-btn\" onclick=\"startBattle(${opp.pet_id})\">\r\n                        <i class=\"fas fa-bolt\"></i> Fight\r\n                    </button>\r\n                </div>\r\n            `).join('');\r\n        } else {\r\n            container.innerHTML = '<div class=\"empty-message\">No opponents available right now. Check back later!</div>';\r\n        }\r\n    } catch (error) {\r\n        console.error('Error loading opponents:', error);\r\n        container.innerHTML = '<div class=\"empty-message\">Failed to load opponents</div>';\r\n    }\r\n}\r\n\r\n// ================================================\r\n// BATTLE ACTIONS\r\n// ================================================\r\n\r\n/**\r\n * Start a battle against an opponent\r\n * @param {number} defenderPetId - The ID of the opponent's pet\r\n * @returns {void}\r\n */\r\nexport function startBattle(defenderPetId) {\r\n    if (!state.activePet) {\r\n        showToast('You need an active pet to battle!', 'warning');\r\n        return;\r\n    }\r\n\r\n    if (state.activePet.status === 'DEAD') {\r\n        showToast('Cannot battle with a dead pet!', 'error');\r\n        return;\r\n    }\r\n\r\n    window.location.href = `battle_arena.php?attacker_id=${state.activePet.id}&defender_id=${defenderPetId}`;\r\n}\r\n\r\n/**\r\n * Display the battle result modal\r\n * @param {Object} data - Battle result data\r\n * @param {number} data.winner_pet_id - ID of the winning pet\r\n * @param {Object} data.attacker - Attacker pet data\r\n * @param {number} data.attacker.pet_id - Attacker pet ID\r\n * @param {string} data.attacker.name - Attacker pet name\r\n * @param {number} data.attacker.final_hp - Attacker's remaining HP\r\n * @param {Object} data.defender - Defender pet data\r\n * @param {number} data.defender.pet_id - Defender pet ID\r\n * @param {string} data.defender.name - Defender pet name\r\n * @param {number} data.defender.final_hp - Defender's remaining HP\r\n * @param {Array<Object>} data.battle_log - Array of battle round logs\r\n * @param {Object} [data.rewards] - Rewards for winner\r\n * @returns {void}\r\n */\r\nexport function showBattleResult(data) {\r\n    const modal = document.getElementById('battle-modal');\r\n\r\n    const title = document.getElementById('battle-title');\r\n    if (data.winner_pet_id === data.attacker.pet_id) {\r\n        title.textContent = 'üëë Victory!';\r\n        title.style.color = '#2ecc71';\r\n    } else if (data.winner_pet_id === data.defender.pet_id) {\r\n        title.textContent = 'üíÄ Defeat';\r\n        title.style.color = '#e74c3c';\r\n    } else {\r\n        title.textContent = '‚öñÔ∏è Draw';\r\n        title.style.color = '#f39c12';\r\n    }\r\n\r\n    document.getElementById('battle-atk-name').textContent = data.attacker.name;\r\n    document.getElementById('battle-atk-hp').textContent = data.attacker.final_hp;\r\n    document.getElementById('battle-def-name').textContent = data.defender.name;\r\n    document.getElementById('battle-def-hp').textContent = data.defender.final_hp;\r\n\r\n    const logEl = document.getElementById('battle-log');\r\n    logEl.innerHTML = data.battle_log.map(entry => `\r\n        <div class=\"battle-log-entry\">\r\n            Round ${entry.round}: <strong>${entry.actor}</strong> ${entry.action}s for <span style=\"color: #e74c3c\">${entry.damage}</span> damage!\r\n        </div>\r\n    `).join('');\r\n\r\n    const rewardsEl = document.getElementById('battle-rewards');\r\n    if (data.winner_pet_id === data.attacker.pet_id && data.rewards) {\r\n        document.getElementById('reward-gold').textContent = data.rewards.gold;\r\n        document.getElementById('reward-exp').textContent = data.rewards.exp;\r\n        rewardsEl.style.display = 'flex';\r\n    } else {\r\n        rewardsEl.style.display = 'none';\r\n    }\r\n\r\n    modal.classList.add('show');\r\n}\r\n\r\n/**\r\n * Close the battle result modal\r\n * @returns {void}\r\n */\r\nexport function closeBattleModal() {\r\n    document.getElementById('battle-modal').classList.remove('show');\r\n}\r\n\r\n// ================================================\r\n// BATTLE HISTORY\r\n// ================================================\r\n\r\n/**\r\n * Load the user's battle history\r\n * @async\r\n * @returns {Promise<void>}\r\n */\r\nexport async function loadBattleHistory() {\r\n    const container = document.getElementById('battle-history');\r\n\r\n    try {\r\n        const response = await fetch(`${API_BASE}?action=battle_history`);\r\n        const data = await response.json();\r\n\r\n        if (data.success && data.battles.length > 0) {\r\n            container.innerHTML = data.battles.map(battle => {\r\n                const date = new Date(battle.created_at).toLocaleDateString();\r\n                return `\r\n                    <div class=\"battle-history-item\">\r\n                        <div class=\"battle-header\">\r\n                            <span class=\"battle-date\">${date}</span>\r\n                        </div>\r\n                        <div class=\"battle-participants\">\r\n                            <span>${battle.atk_display}</span>\r\n                            <span class=\"battle-vs\">VS</span>\r\n                            <span>${battle.def_display}</span>\r\n                        </div>\r\n                    </div>\r\n                `;\r\n            }).join('');\r\n        } else {\r\n            container.innerHTML = '<div class=\"empty-message\">No battles yet. Challenge someone!</div>';\r\n        }\r\n    } catch (error) {\r\n        console.error('Error loading battle history:', error);\r\n    }\r\n}\r\n","/**\r\n * Main Entry Point\r\n * MOE Pet System\r\n * \r\n * Initializes the pet system and exposes functions to window for HTML onclick handlers\r\n */\r\n\r\n// Import all modules\r\nimport { initTabs, switchTab, checkUrlErrors, checkDailyReward, initGoldToggle, showToast, updateGoldDisplay, claimDailyReward, closeDailyModal } from './ui.js';\r\nimport { loadPets, loadActivePet, selectPet, playWithPet, toggleShelter, initActionButtons, renderActivePet, getPetImagePath } from './pets.js';\r\nimport { renderCollection } from './collection.js';\r\nimport { loadInventory, renderInventory, handleInventoryClick, adjustQty, setMaxQty, closeBulkModal, confirmBulkUse, useItem, openItemModal, closeItemModal, openReviveModal, closeReviveModal, revivePet } from './inventory.js';\r\nimport { performGacha, showGachaResult, closeGachaModal } from './gacha.js';\r\nimport { initShopTabs, loadShop, renderShopItems, buyItem, closeShopPurchaseModal, adjustShopQty, updateShopTotal, confirmShopPurchase } from './shop.js';\r\nimport { initArenaTabs, loadOpponents, startBattle, showBattleResult, closeBattleModal, loadBattleHistory } from './arena.js';\r\nimport { state } from './state.js';\r\n\r\nconsole.log('üêæ MOE Pet System - ES6 Modules Loaded');\r\n\r\n// ================================================\r\n// INITIALIZATION\r\n// ================================================\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    console.log('üöÄ Initializing Pet System...');\r\n\r\n    initTabs();\r\n    initActionButtons();\r\n    initShopTabs();\r\n    initArenaTabs();\r\n    initGoldToggle();\r\n    loadPets();\r\n    checkDailyReward();\r\n    checkUrlErrors();\r\n\r\n    console.log('‚úÖ Pet System Ready!');\r\n});\r\n\r\n// ================================================\r\n// TAB CHANGE HANDLER\r\n// ================================================\r\n\r\ndocument.addEventListener('tabChanged', (e) => {\r\n    const tab = e.detail.tab;\r\n\r\n    switch (tab) {\r\n        case 'my-pet':\r\n            if (state.activePet) {\r\n                renderActivePet();\r\n            } else {\r\n                loadActivePet();\r\n            }\r\n            break;\r\n        case 'collection':\r\n            loadPets();\r\n            break;\r\n        case 'gacha':\r\n            // Gacha tab - no data loading needed\r\n            break;\r\n        case 'shop':\r\n            loadShop();\r\n            loadInventory();\r\n            break;\r\n        case 'arena':\r\n            loadActivePet();\r\n            loadOpponents();\r\n            break;\r\n    }\r\n});\r\n\r\n// ================================================\r\n// EXPOSE FUNCTIONS TO WINDOW FOR HTML ONCLICK\r\n// ================================================\r\n\r\n// UI Functions\r\nwindow.showToast = showToast;\r\nwindow.switchTab = switchTab;\r\nwindow.updateGoldDisplay = updateGoldDisplay;\r\nwindow.claimDailyReward = claimDailyReward;\r\nwindow.closeDailyModal = closeDailyModal;\r\n\r\n// Pet Functions\r\nwindow.selectPet = selectPet;\r\nwindow.playWithPet = playWithPet;\r\nwindow.toggleShelter = toggleShelter;\r\nwindow.renderActivePet = renderActivePet;\r\nwindow.loadPets = loadPets;\r\nwindow.loadActivePet = loadActivePet;\r\nwindow.getPetImagePath = getPetImagePath;\r\n\r\n// Collection Functions\r\nwindow.renderCollection = renderCollection;\r\n\r\n// Inventory Functions\r\nwindow.handleInventoryClick = handleInventoryClick;\r\nwindow.adjustQty = adjustQty;\r\nwindow.setMaxQty = setMaxQty;\r\nwindow.closeBulkModal = closeBulkModal;\r\nwindow.confirmBulkUse = confirmBulkUse;\r\nwindow.useItem = useItem;\r\nwindow.openItemModal = openItemModal;\r\nwindow.closeItemModal = closeItemModal;\r\nwindow.openReviveModal = openReviveModal;\r\nwindow.closeReviveModal = closeReviveModal;\r\nwindow.revivePet = revivePet;\r\nwindow.loadInventory = loadInventory;\r\n\r\n// Gacha Functions\r\nwindow.performGacha = performGacha;\r\nwindow.showGachaResult = showGachaResult;\r\nwindow.closeGachaModal = closeGachaModal;\r\n\r\n// Shop Functions\r\nwindow.buyItem = buyItem;\r\nwindow.closeShopPurchaseModal = closeShopPurchaseModal;\r\nwindow.adjustShopQty = adjustShopQty;\r\nwindow.updateShopTotal = updateShopTotal;\r\nwindow.confirmShopPurchase = confirmShopPurchase;\r\nwindow.loadShop = loadShop;\r\n\r\n// Arena Functions\r\nwindow.startBattle = startBattle;\r\nwindow.showBattleResult = showBattleResult;\r\nwindow.closeBattleModal = closeBattleModal;\r\nwindow.loadOpponents = loadOpponents;\r\nwindow.loadBattleHistory = loadBattleHistory;\r\n"],"names":["API_BASE","ASSETS_BASE","state","value","showToast","message","type","toast","icon","msg","icons","initTabs","btn","tab","switchTab","content","event","formatGold","amount","compact","updateGoldDisplay","gold","goldEl","r","d","initGoldToggle","e","checkUrlErrors","error","checkDailyReward","data","showDailyRewardModal","modal","calendar","currentDayEl","rewardText","totalLogins","rewardStr","calendarHTML","specialDays","day","classes","claimDailyReward","closeDailyModal","loadPets","updatePetCountBadge","p","renderActivePet","loadActivePet","showNoPetMessage","noPetMsg","petZone","infoHeader","statsContainer","expCard","actions","imgPath","getPetImagePath","shinyStyle","petContainer","shinySparkles","displayName","elementBadge","rarityBadge","shinyTag","updateCircularProgress","expNeeded","expPercent","shelterBtn","labelEl","iconEl","ring","valueEl","circumference","offset","stage","selectPet","petId","pet","toggleShelter","initActionButtons","playWithPet","rhythmModal","targetPetId","imgKeys","key","petCountBadge","petCount","renderCollection","grid","displayPets","activeClass","deadClass","elementIcon","actionButtonHTML","loadInventory","renderInventory","updateInventoryCount","item","rarity","isDepleted","countEl","count","handleInventoryClick","itemId","itemName","itemDesc","itemImg","maxQty","useItem","openReviveModal","adjustQty","input","val","setMaxQty","closeBulkModal","confirmBulkUse","qty","quantity","closeItemModal","openItemModal","list","items","deadPets","deadPetsList","closeReviveModal","revivePet","performGacha","egg","gachaType","showGachaResult","modalContent","species","elementEl","titleEl","titleText","shinyBadge","resultPet","closeGachaModal","initShopTabs","t","renderShopItems","loadShop","getItemCategory","effectType","getItemIcon","name","category","filtered","i","isNew","buyItem","searchId","updateShopTotal","closeShopPurchaseModal","adjustShopQty","total","confirmShopPurchase","initArenaTabs","view","loadOpponents","loadBattleHistory","container","opp","startBattle","defenderPetId","showBattleResult","title","logEl","entry","rewardsEl","closeBattleModal","battle"],"mappings":"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"}