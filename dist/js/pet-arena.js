window.startBattle=function(t){console.log("Starting battle with defender:",t);let e=window.activePet;if(!e&&window.userPets&&window.userPets.length>0&&(e=window.userPets.find(n=>n.is_active===1||n.is_active==="1"),console.log("Found active pet from userPets:",e)),!e){typeof showToast=="function"?showToast("You need an active pet to battle!","warning"):alert("You need an active pet to battle! Please select a pet first."),console.error("No active pet found. window.userPets:",window.userPets);return}if(e.status==="DEAD"){typeof showToast=="function"?showToast("Cannot battle with a dead pet!","error"):alert("Your pet is dead! Revive it first.");return}console.log("Redirecting to battle arena..."),window.location.href=`battle_arena.php?attacker_id=${e.id}&defender_id=${t}`};console.log("âœ“ Arena module loaded");async function c(){const t=document.getElementById("arena-battles"),e=document.getElementById("total-wins"),n=document.getElementById("win-rate"),o=document.getElementById("current-streak");t&&(t.innerHTML='<i class="fas fa-spinner fa-spin"></i>'),e&&(e.innerHTML='<i class="fas fa-spinner fa-spin"></i>'),n&&(n.innerHTML='<i class="fas fa-spinner fa-spin"></i>'),o&&(o.innerHTML='<i class="fas fa-spinner fa-spin"></i>');try{console.log("ðŸ” Fetching arena stats...");const s=await fetch("api/router.php?action=battle_history");if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const i=await s.json();if(console.log("ðŸ“Š API Response:",i),i.success){const a=i.stats||{},r=a.wins||0,l=a.losses||0,d=a.current_streak||0,f=a.battles_remaining!==void 0?a.battles_remaining:3;console.log("âœ… Stats parsed:",{wins:r,losses:l,streak:d,battlesRemaining:f}),u(r,l,d),t&&(t.textContent=`${f} / 3`),console.log("âœ… Arena stats updated successfully")}else throw console.error("âŒ API returned success: false",i),new Error(i.error||"Failed to load stats")}catch(s){console.error("âŒ Error loading arena stats:",s),t&&(t.textContent="3 / 3"),e&&(e.textContent="0"),n&&(n.textContent="0%"),o&&(o.textContent="0"),typeof showToast=="function"&&showToast("Failed to load arena stats","error")}}function u(t,e,n){const o=document.getElementById("total-wins");o&&(o.textContent=t||0);const s=(t||0)+(e||0),i=s>0?Math.round(t/s*100):0,a=document.getElementById("win-rate");a&&(a.textContent=`${i}%`);const r=document.getElementById("current-streak");r&&(r.textContent=n||0)}document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector('[data-tab="arena"]');t&&t.addEventListener("click",()=>{setTimeout(c,100)});const e=document.getElementById("arena");e&&e.classList.contains("active")&&c(),document.addEventListener("visibilitychange",()=>{if(!document.hidden){const n=document.getElementById("arena");n&&n.classList.contains("active")&&c()}})});
//# sourceMappingURL=pet-arena.js.map
